define("RepositoryBrowser",["Class","jquery","PubSub","repository-browser-i18n-"+(window&&window.__DEPS__&&window.__DEPS__.lang||"en"),"jstree","jqgrid","jquery-layout"],function(m,c,n,o){function p(a){a.each(function(){c(this).attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}).each(function(){this.onselectstart=function(){return!1}})})}var j=[],k=0,g=(new Date).getTime(),q={repositoryManager:null,repositoryFilter:[],objectTypeFilter:[],renditionFilter:["cmis:none"],
filter:["url"],element:null,isFloating:!1,verticalPadding:100,horizontalPadding:50,maxHeight:1E3,minHeight:400,minWidth:400,maxWidth:1200,treeWidth:300,listWidth:"auto",pageSize:8,rootPath:"",rootFolderId:"aloha",columns:{icon:{title:"",width:30,sortable:!1,resizable:!1},name:{title:"Name",width:200,sorttype:"text"},url:{title:"URL",width:220,sorttype:"text"},preview:{title:"Preview",width:150,sorttype:"text"}},i18n:{Browsing:"Browsing",Close:"Close","in":"in","Input search text...":"Input search text...",
numerous:"numerous",of:"of","Repository Browser":"Repository Browser",Search:"Search","Searching for":"Searching for",Viewing:"Viewing"}};return m.extend({_cachedRepositoryObjects:{},_searchQuery:null,_orderBy:null,$_grid:null,$_tree:null,$_list:null,_isOpened:!0,_constructor:function(){this.init.apply(this,arguments)},init:function(a){a=c.extend({},q,a,{i18n:o});if(!a.element||0===a.element.length)a.isFloating=!0,a.element=this._createOverlay();if(a.maxWidth<a.minWidth)a.maxWidth=a.minWidth;c.extend(this,
a);this._cachedRepositoryObjects={};this._pagingCount=this._orderBy=this._searchQuery=null;this._pagingOffset=0;this._pagingBtns={first:null,end:null,next:null,prev:null};this._initializeUI();j.push(this);n.pub("repository-browser.initialized",{data:this})},_i18n:function(a){return this.i18n[a]||a},_initializeUI:function(){this.element.attr("data-repository-browser",++g);this.element.width(this.maxWidth);this.$_grid=this._createGrid(this.element).resize();this._setIntialHeight();this.$_tree=this._createTree(this.$_grid.find(".ui-layout-west"));
this.$_list=this._createList(this.$_grid.find(".ui-layout-center"));var a=this,b=this.treeWidth/5;this.$_grid.layout({enableCursorHotkey:!1,west__size:this.treeWidth-1,west__minSize:this.treeWidth-b,west__maxSize:this.treeWidth+b,center__size:"auto",paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",onresize:function(b,c){"center"===b&&a.$_list.setGridWidth(c.width())}}).sizePane("west",this.treeWidth);p(this.$_grid);this._preloadImages();c(function(){c(window).resize(function(){a._onWindowResized()})});
this.element.mousedown(function(){c.each(j,function(a){this.element.css("z-index",99999+a)});c(this).css("z-index",99999+j.length+1)});c(".repository-browser-grid").css("width",this.maxWidth);this.close()},_setIntialHeight:function(){var a=this.maxHeight-c(window).height()+this.verticalPadding;this.$_grid.height(a>0?Math.max(this.minHeight,this.maxHeight-a):this.maxHeight)},_onWindowResized:function(){var a=this.maxWidth-c(window).width()+this.horizontalPadding,a=a>0?Math.max(this.minWidth,this.maxWidth-
a):this.maxWidth;this.element.width(a);this.$_grid.width(a)},_preloadImages:function(){for(var a=this.rootPath+"img/",b="arrow-000-medium.png,arrow-180.png,arrow-315-medium.png,arrow-stop-180.png,arrow-stop.png,arrow.png,control-stop-square-small.png,folder-horizontal-open.png,folder-open.png,magnifier-left.png,page.png,picture.png,sort-alphabet-descending.png,sort-alphabet.png".split(","),d=b.length;d;)document.createElement("img").src=a+b[--d]},_processRepoResponse:function(a,b,d){var c=[],f;typeof b===
"function"&&(d=b,b=void 0);for(f=0;f<a.length;f++)c.push(this._harvestRepoObject(a[f]));d(c,b)},_harvestRepoObject:function(a){++g;this._cachedRepositoryObjects[g]=c.extend(a,{uid:g,loaded:!1});var a=this._cachedRepositoryObjects[g],b;switch(a.baseType){case "folder":b="folder";break;case "document":b="document"}return{data:{title:a.name,attr:{"data-repo-obj":a.uid},icon:b||""},attr:a.type?{rel:a.type}:void 0,state:a.hasMoreItems||"folder"===a.baseType?"closed":null,resource:a}},_fetchRepoRoot:function(a){this.repositoryManager&&
this.getRepoChildren({inFolderId:this.rootFolderId,repositoryFilter:this.repositoryFilter},a)},_getObjectFromCache:function(a){return a&&a.length?this._cachedRepositoryObjects[a.find("a:first").attr("data-repo-obj")]:null},_onTreeNodeSelected:function(a,b){if(!b.args[0].context){var d=this._getObjectFromCache(b.rslt.obj);if(d)this._pagingOffset=0,this._searchQuery=null,this._currentFolder=d,this._fetchItems(d)}},_createTree:function(a){var b=c('<div class="repository-browser-tree">'),d=c('<div class="repository-browser-tree-header repository-browser-grab-handle">'+
this._i18n("Repository Browser")+"</div>");a.append(d,b);b.height(this.$_grid.height()-d.outerHeight(!0));b.bind("loaded.jstree",function(){c(this).find(">ul>li:first").css("padding-top",5);b.jstree("open_node",'li[rel="repository"]')});var e=this;b.bind("select_node.jstree",function(a,b){e._onTreeNodeSelected(a,b)});b.jstree({types:this.types,rootFolderId:this.rootFolderId,plugins:["themes","json_data","ui","types"],core:{animation:250},themes:{url:this.rootPath+"css/jstree.css",dots:!0,icons:!0,
theme:"browser"},json_data:{data:function(a,b){e.repositoryManager?(e.jstree_callback=b,e._fetchSubnodes(a,b)):b()},correct_state:!0},ui:{select_limit:1}});return b},_createGrid:function(a){var b=c('<div class="repository-browser-grid\t\t\t\t             repository-browser-shadow\t\t\t\t\t\t\t repository-browser-rounded-top">\t\t\t\t\t<div class="ui-layout-west"></div>\t\t\t\t\t<div class="ui-layout-center"></div>\t\t\t\t</div>');a.append(b);return b},_createList:function(a){var b=c('<table id="repository-browser-list-'+
++g+'" class="repository-browser-list"></table>'),d=[{name:"id",sorttype:"int",firstsortorder:"asc",hidden:!0}],e=[""];c.each(this.columns,function(a,b){e.push(b.title||"&nbsp;");d.push({name:a,width:b.width,sortable:b.sortable,sorttype:b.sorttype,resizable:b.resizable,fixed:b.fixed})});var f="repository-browser-list-page-"+ ++g;a.append(b,c('<div id="'+f+'">'));b.jqGrid({datatype:"local",width:a.width(),shrinkToFit:!0,colNames:e,colModel:d,caption:"&nbsp;",altRows:!0,altclass:"repository-browser-list-altrow",
resizeclass:"repository-browser-list-resizable",pager:"#"+f,viewrecords:!0,onPaging:function(){},loadError:function(){},ondblClickRow:function(){},gridComplete:function(){},loadComplete:function(){}});a.find(".ui-jqgrid-bdiv").height(this.$_grid.height()-(a.find(".ui-jqgrid-titlebar").height()+a.find(".ui-jqgrid-hdiv").height()+a.find(".ui-jqgrid-pager").height()));var h=this;b.click(function(){h.rowClicked.apply(h,arguments)});a.find(".ui-pg-button").unbind().find(">span.ui-icon").each(function(){var a=
this.className.match(/ui\-icon\-seek\-([a-z]+)/)[1];h._pagingBtns[a]=c(this).parent().addClass("ui-state-disabled").click(function(){c(this).hasClass("ui-state-disabled")||h._doPaging(a)})});a.find(".ui-pg-input").parent().hide();a.find(".ui-separator").parent().css("opacity",0).first().hide();this._createTitlebar(a);var l=b[0].p;a.find(".ui-jqgrid-view tr:first th div").each(function(a){!1!==l.colModel[a].sortable&&(c(this).css("cursor","pointer"),c(this).unbind().click(function(b){b.stopPropagation();
h._sortList(l.colModel[a],this)}))});return b},_createTitlebar:function(a){var a=a.find(".ui-jqgrid-titlebar"),b=c('<div class="repository-browser-btns">\t\t\t\t\t<input type="text" class="repository-browser-search-field" />\t\t\t\t\t<span class="repositroy-browser-btn repository-browser-search-btn">\t\t\t\t\t\t<span class="repository-browser-search-icon"></span>\t\t\t\t\t</span>\t\t\t\t\t<span class="repository-browser-btn repository-browser-close-btn">'+this._i18n("Close")+'</span>\t\t\t\t\t<div class="repository-browser-clear"></div>\t\t\t\t</div>'),
d=this;a.addClass("repository-browser-grab-handle").append(b);a.find(".repository-browser-search-btn").html(this._i18n("Search")).click(function(){d._triggerSearch()});var e=this._i18n("Input search text..."),b=a.find(".repository-browser-search-field");b.val(e).addClass("repository-browser-search-field-empty");b.keypress(function(a){13===a.keyCode&&d._triggerSearch()});b.focus(function(){c(this).val()===e&&c(this).val("").removeClass("repository-browser-search-field-empty")});b.blur(function(){c(this).val()===
""&&c(this).val(e).addClass("repository-browser-search-field-empty")});a.find(".repository-browser-close-btn").click(function(){d.close()});a.find(".repository-browser-btn").mousedown(function(){c(this).addClass("repository-browser-pressed")}).mouseup(function(){c(this).removeClass("repository-browser-pressed")})},_triggerSearch:function(){var a=this.$_grid.find("input.repository-browser-search-field"),b=a.val();if(c(a).hasClass("aloha-browser-search-field-empty")||""==b.val())b=null;this._pagingOffset=
0;this._searchQuery=b;this._fetchItems(this._currentFolder)},_sortList:function(a,b){this.$_grid.find("span.ui-grid-ico-sort").addClass("ui-state-disabled");a.sortorder="asc"===a.sortorder?"desc":"asc";c(b).find("span.s-ico").show().find(".ui-icon-"+a.sortorder).removeClass("ui-state-disabled");this._setSortOrder(a.name,a.sortorder);this._fetchItems(this._currentFolder)},_doPaging:function(a){switch(a){case "first":this._pagingOffset=0;break;case "end":this._pagingOffset=this._pagingCount%this.pageSize===
0?this._pagingCount-this.pageSize:this._pagingCount-this._pagingCount%this.pageSize;break;case "next":this._pagingOffset+=this.pageSize;break;case "prev":this._pagingOffset-=this.pageSize}this._fetchItems(this._currentFolder)},_setSortOrder:function(a,b){var d={},c=!1,f=this._orderBy||[],h,g,i;d[a]=b||"asc";for(i=0;i<f.length;++i){h=f[i];for(g in h)if(h.hasOwnProperty(g)&&g===a){f.splice(i,1);f.unshift(d);c=!0;break}if(c)break}c&&f.unshift(d);this._orderBy=f},_listItems:function(a){var b=this.$_list.clearGridData(),
d,e;for(d=0;d<a.length;d++)e=a[d].resource,b.addRowData(e.uid,c.extend({id:e.id},this.renderRowCols(e)))},_processItems:function(a,b){this._pagingCount=b&&c.isNumeric(b.numItems)?b.numItems:null;this.$_grid.find(".loading").hide();this.$_list.show();this._listItems(a);var d=this._pagingBtns;this._pagingOffset<=0?d.first.add(d.prev).addClass("ui-state-disabled"):d.first.add(d.prev).removeClass("ui-state-disabled");c.isNumeric(this._pagingCount)?(d.end.addClass("ui-state-disabled"),a.length<this.pageSize?
d.next.addClass("ui-state-disabled"):d.next.removeClass("ui-state-disabled")):this._pagingOffset+this.pageSize>=this._pagingCount?d.end.add(d.next).addClass("ui-state-disabled"):d.end.add(d.next).removeClass("ui-state-disabled");var e;0===a.length&&0===this._pagingOffset?e=d=0:(d=this._pagingOffset+1,e=d+a.length-1);this.$_grid.find(".ui-paging-info").html(this._i18n("Viewing")+" "+d+" - "+e+" "+this._i18n("of")+" "+(c.isNumeric(this._pagingCount)?this._pageingCount:this._i18n("numerous")))},_createOverlay:function(){0===
c(".repository-browser-modal-overlay").length&&c("body").append('<div class="repository-browser-modal-overlay" style="top: -99999px; z-index: 99999;"></div>');var a=this;c(".repository-browser-modal-overlay").click(function(){a.close()});var b=c('<div class="repository-browser-modal-window" style="top: -99999px; z-index: 99999;">');c("body").append(b);return b},_fetchSubnodes:function(a,b){if(-1===a)this._fetchRepoRoot(b);else{var d;for(d=0;d<a.length;d++){var c=this._getObjectFromCache(a.eq(d));
c&&this.fetchChildren(c,b)}}},getRepoChildren:function(a,b){if(this.repositoryManager){var d=this;this.repositoryManager.getChildren(a,function(a){d._processRepoResponse(a,b)})}},queryRepository:function(a,b){if(this.repositoryManager){var d=this;this.repositoryManager.query(a,function(a){d._processRepoResponse(a.results>0?a.items:[],{numItems:a.numItems,hasMoreItems:a.hasMoreItems},b)})}},renderRowCols:function(a){var b={};c.each(this.columns,function(d){switch(d){case "icon":b.icon='<div class="repository-browser-icon repository-browser-icon-'+
a.type+'"></div>';break;default:b[d]=a[d]||"--"}});return b},onSelect:function(){},fetchChildren:function(a,b){if((!0===a.hasMoreItems||"folder"===a.baseType)&&!1===a.loaded){var d=this;this.getRepoChildren({inFolderId:a.id,repositoryId:a.repositoryId},function(c){d._cachedRepositoryObjects[a.uid].loaded=!0;typeof b==="function"&&b(c)})}},rowClicked:function(a){a=c(a.target).parent("tr");return a.length?(a=this._cachedRepositoryObjects[a.attr("id")],this.onSelect(a),a):null},getFieldOfHeader:function(a){return a.find("div.ui-jqgrid-sortable").attr("id").replace("jqgh_",
"")},_fetchItems:function(a){if(a){var b=typeof this._searchQuery==="string";this.$_list.setCaption(typeof this._searchQuery==="string"?this._i18n("Searching for")+' "'+this._searchQuery+'" '+this._i18n("in")+" "+a.name:this._i18n("Browsing")+": "+a.name);this.$_list.hide();this.$_grid.find(".loading").show();var c=this;this.queryRepository({repositoryId:a.repositoryId,inFolderId:a.id,queryString:this._searchQuery,orderBy:this._orderBy,skipCount:this._pagingOffset,maxItems:this.pageSize,objectTypeFilter:this.objectTypeFilter,
renditionFilter:this.renditionFilter,filter:this.filter,recursive:b},function(a,b){c._processItems(a,b)})}},setObjectTypeFilter:function(a){this.objectTypeFilter=typeof a==="string"?[a]:a},getObjectTypeFilter:function(){return this.objectTypeFilter},show:function(){this.open()},open:function(){if(!this._isOpened){this._isOpened=!0;var a=this.element;if(this.isFloating){c(".repository-browser-modal-overlay").stop().css({top:0,left:0}).show();a.stop().show();var b=c(window);a.css({left:(b.width()-a.width())/
2-30,top:(b.height()-a.height())/3+10}).draggable({handle:a.find(".repository-browser-grab-handle")});this.$_grid.css({marginTop:0,opacity:0}).animate({marginTop:0,opacity:1},1500,"easeOutExpo",function(){c.browser.msie&&c(this).add(a).css("filter","progid:DXImageTransform.Microsoft.gradient(enabled=false)")})}else a.stop().show().css({opacity:1,filter:"progid:DXImageTransform.Microsoft.gradient(enabled=false)"});this._onWindowResized();++k}},close:function(){if(this._isOpened)this._isOpened=!1,this.element.fadeOut(250,
function(){c(this).css("top",0).hide();(0===k||0===--k)&&c(".repository-browser-modal-overlay").hide()})},refresh:function(){this._currentFolder&&this._fetchItems(this._currentFolder)}})});define("repository-browser-i18n-de",[],function(){return{Browsing:"Browsing",Close:"Schließn","in":"in","Input search text...":"Suchtext einfü.gen...",numerous:"zahlreich",of:"von","Repository Browser":"Repository Browser",Search:"Süchen","Searching for":"Suche nach",Viewing:"Anzeige","button.switch-metaview.tooltip":"Zwischen Metaansicht und normaler Ansicht umschalten"}});define("repository-browser-i18n-en",[],function(){return{Browsing:"Browsing",Close:"Close","in":"in","Input search text...":"Input search text...",numerous:"numerous",of:"of","Repository Browser":"Repository Browser",Search:"Search","Searching for":"Searching for",Viewing:"Viewing","button.switch-metaview.tooltip":"Switch between meta and normal view"}});